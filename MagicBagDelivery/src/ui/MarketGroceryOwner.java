/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package ui;

import java.time.LocalDate;
import java.util.Date;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import model.Market;
import model.OrderList;
import model.customers;
import model.markets;
import model.order;
import projects.InsertUpdateDelete;
import projects.Select;
import java.sql.*;
import model.Validation;

/**
 *
 * @author evelyn
 */
public class MarketGroceryOwner extends javax.swing.JPanel {

    /**
     * Creates new form Resaurant
     */
 
    public MarketGroceryOwner() {
        initComponents();
        
        Table();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        MarketGrocery = new javax.swing.JPanel();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTable2 = new javax.swing.JTable();
        searchtxt1 = new javax.swing.JTextField();
        jLabel7 = new javax.swing.JLabel();
        btnconfirm1 = new javax.swing.JButton();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        MarketCustomerOrder = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        jLabel10 = new javax.swing.JLabel();
        txtMarket = new javax.swing.JTextField();
        txtuser = new javax.swing.JTextField();
        txtaddress = new javax.swing.JTextField();
        txtprice = new javax.swing.JTextField();
        jLabel11 = new javax.swing.JLabel();
        btnback = new javax.swing.JButton();
        btnconfirm2 = new javax.swing.JButton();
        typeComboBox = new javax.swing.JComboBox<>();
        AmountComboBox = new javax.swing.JComboBox<>();
        jLabel3 = new javax.swing.JLabel();
        jLabel12 = new javax.swing.JLabel();
        jLabel13 = new javax.swing.JLabel();
        jTextField1 = new javax.swing.JTextField();
        jLabel14 = new javax.swing.JLabel();
        jTextField2 = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();

        setBackground(new java.awt.Color(255, 255, 255));
        setLayout(new java.awt.CardLayout());

        MarketGrocery.setLayout(null);

        jTable2.setBackground(new java.awt.Color(204, 255, 204));
        jTable2.setFont(new java.awt.Font("Helvetica Neue", 3, 12)); // NOI18N
        jTable2.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Name", "Address", "Ranking Score", "Price"
            }
        ));
        jScrollPane2.setViewportView(jTable2);

        MarketGrocery.add(jScrollPane2);
        jScrollPane2.setBounds(120, 200, 580, 225);

        searchtxt1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                searchtxt1ActionPerformed(evt);
            }
        });
        searchtxt1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                searchtxt1KeyReleased(evt);
            }
        });
        MarketGrocery.add(searchtxt1);
        searchtxt1.setBounds(380, 160, 180, 23);

        jLabel7.setBackground(new java.awt.Color(255, 255, 255));
        jLabel7.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        jLabel7.setForeground(new java.awt.Color(102, 204, 0));
        jLabel7.setText("Search:");
        MarketGrocery.add(jLabel7);
        jLabel7.setBounds(300, 150, 130, 40);

        btnconfirm1.setBackground(new java.awt.Color(204, 255, 204));
        btnconfirm1.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        btnconfirm1.setForeground(new java.awt.Color(102, 204, 0));
        btnconfirm1.setText("Confirm");
        btnconfirm1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnconfirm1ActionPerformed(evt);
            }
        });
        MarketGrocery.add(btnconfirm1);
        btnconfirm1.setBounds(610, 460, 160, 30);

        jLabel4.setFont(new java.awt.Font("Kokonor", 1, 24)); // NOI18N
        jLabel4.setText("Find a Gorcery");
        MarketGrocery.add(jLabel4);
        jLabel4.setBounds(350, 100, 200, 42);

        jLabel5.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ui/picture/1-1024x1024.jpeg"))); // NOI18N
        MarketGrocery.add(jLabel5);
        jLabel5.setBounds(0, 0, 800, 740);

        add(MarketGrocery, "card3");

        MarketCustomerOrder.setLayout(null);

        jLabel2.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        jLabel2.setForeground(new java.awt.Color(0, 51, 0));
        jLabel2.setText("User Name:");
        MarketCustomerOrder.add(jLabel2);
        jLabel2.setBounds(230, 240, 180, 23);

        jLabel8.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        jLabel8.setForeground(new java.awt.Color(0, 51, 0));
        jLabel8.setText("Amount:");
        MarketCustomerOrder.add(jLabel8);
        jLabel8.setBounds(260, 190, 120, 23);

        jLabel9.setBackground(new java.awt.Color(204, 255, 204));
        jLabel9.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        jLabel9.setForeground(new java.awt.Color(0, 51, 0));
        jLabel9.setText("Market address:");
        MarketCustomerOrder.add(jLabel9);
        jLabel9.setBounds(200, 140, 150, 23);

        jLabel10.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        jLabel10.setForeground(new java.awt.Color(0, 51, 0));
        jLabel10.setText("User Address:");
        MarketCustomerOrder.add(jLabel10);
        jLabel10.setBounds(210, 290, 170, 30);
        MarketCustomerOrder.add(txtMarket);
        txtMarket.setBounds(350, 90, 207, 23);
        MarketCustomerOrder.add(txtuser);
        txtuser.setBounds(350, 240, 207, 23);
        MarketCustomerOrder.add(txtaddress);
        txtaddress.setBounds(350, 300, 207, 23);
        MarketCustomerOrder.add(txtprice);
        txtprice.setBounds(350, 420, 130, 23);

        jLabel11.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        jLabel11.setForeground(new java.awt.Color(0, 51, 0));
        jLabel11.setText("Order type:");
        MarketCustomerOrder.add(jLabel11);
        jLabel11.setBounds(240, 360, 130, 23);

        btnback.setBackground(new java.awt.Color(204, 255, 204));
        btnback.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        btnback.setForeground(new java.awt.Color(102, 204, 0));
        btnback.setText("Back");
        btnback.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnbackActionPerformed(evt);
            }
        });
        MarketCustomerOrder.add(btnback);
        btnback.setBounds(630, 30, 120, 29);

        btnconfirm2.setBackground(new java.awt.Color(204, 255, 204));
        btnconfirm2.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        btnconfirm2.setForeground(new java.awt.Color(0, 51, 0));
        btnconfirm2.setText("Confirm");
        btnconfirm2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnconfirm2ActionPerformed(evt);
            }
        });
        MarketCustomerOrder.add(btnconfirm2);
        btnconfirm2.setBounds(330, 540, 120, 29);

        typeComboBox.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        typeComboBox.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Delivery", "Pick-up" }));
        MarketCustomerOrder.add(typeComboBox);
        typeComboBox.setBounds(350, 360, 130, 29);

        AmountComboBox.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "1" }));
        MarketCustomerOrder.add(AmountComboBox);
        AmountComboBox.setBounds(350, 190, 130, 23);

        jLabel3.setFont(new java.awt.Font("Kokonor", 1, 24)); // NOI18N
        jLabel3.setText("Create a order");
        MarketCustomerOrder.add(jLabel3);
        jLabel3.setBounds(310, 30, 200, 42);

        jLabel12.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        jLabel12.setForeground(new java.awt.Color(0, 51, 0));
        jLabel12.setText("Phone Number:");
        MarketCustomerOrder.add(jLabel12);
        jLabel12.setBounds(200, 480, 140, 23);

        jLabel13.setBackground(new java.awt.Color(204, 255, 204));
        jLabel13.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        jLabel13.setForeground(new java.awt.Color(0, 51, 0));
        jLabel13.setText("Market Name:");
        MarketCustomerOrder.add(jLabel13);
        jLabel13.setBounds(220, 90, 120, 23);
        MarketCustomerOrder.add(jTextField1);
        jTextField1.setBounds(350, 140, 210, 23);

        jLabel14.setFont(new java.awt.Font("Helvetica Neue", 1, 18)); // NOI18N
        jLabel14.setForeground(new java.awt.Color(0, 51, 0));
        jLabel14.setText("Price:");
        MarketCustomerOrder.add(jLabel14);
        jLabel14.setBounds(290, 420, 49, 23);
        MarketCustomerOrder.add(jTextField2);
        jTextField2.setBounds(350, 480, 200, 30);

        jLabel6.setBackground(new java.awt.Color(204, 255, 204));
        jLabel6.setFont(new java.awt.Font("Helvetica Neue", 3, 14)); // NOI18N
        jLabel6.setForeground(new java.awt.Color(0, 51, 51));
        jLabel6.setText("One person only can buy one Magicbag!");
        MarketCustomerOrder.add(jLabel6);
        jLabel6.setBounds(490, 190, 280, 30);

        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ui/picture/1-1024x1024.jpeg"))); // NOI18N
        jLabel1.setText("jLabel1");
        MarketCustomerOrder.add(jLabel1);
        jLabel1.setBounds(0, 0, 800, 740);

        add(MarketCustomerOrder, "card2");
    }// </editor-fold>//GEN-END:initComponents
  public void Table(){
       ResultSet rs=Select.getData("select a.`Name`,a.Address,a.Category,a.Price, b.score from market a left join(select market, AVG(marketscore) as score from orders group by market)b on a.`Name`=b.market where a.Category='Grocery' ");
        DefaultTableModel model=(DefaultTableModel)jTable2.getModel();
        model.setRowCount(0);
        try {
            while(rs.next())
            {
                model.addRow(new Object[]{rs.getString(1),rs.getString(2),rs.getFloat(5),rs.getFloat(4)});
            }
            rs.close();
                
            
        } catch (Exception e)
        {
            JOptionPane.showConfirmDialog(null, e);
        }
    }
 
    private void btnconfirm2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnconfirm2ActionPerformed
        // TODO add your handling code here:
        Date date = new Date();
        int orderID = (int) (Math.random() * 100000);
        String market = txtMarket.getText();
        String marketaddress=jTextField1.getText();
        int amount= Integer.parseInt((String)AmountComboBox.getSelectedItem());
        String user = txtuser.getText();
        String address = txtaddress.getText();
        String type = (String.valueOf(typeComboBox.getSelectedItem()));
        float price=Float.parseFloat(txtprice.getText());
        String Phone=jTextField2.getText();
        
       

        if (txtuser.getText().equals("") || txtaddress.getText().equals(""))
        JOptionPane.showConfirmDialog(null, "Every Filed is Required!");
        else if(Validation.isName(user)==false){
               JOptionPane.showMessageDialog(this, "Name should be letters.");
            }
              else if(Validation.isPhone(jTextField2.getText())==false){
               JOptionPane.showMessageDialog(this, "Phone number should be 10 numbers.");
            }
        else {

            String Query;
            Query="update market set amount=amount-1 where Name='"+market+"'";
            InsertUpdateDelete.setData(Query, "");
            String Query1;
    
            Query1 = "insert into orders(ordertime,orderID,market,marketaddress,customer,cusaddress,method,amout,price,status,phone) values('"+date+"','"+orderID+"','"+market+"','"+marketaddress+"','"+user+"','"+address+"','"+type+"','"+amount+"','"+price+"','Created','"+Phone+"')";
            InsertUpdateDelete.setData(Query1, "New Order is confirmed!");
      

            // price 计算 String price = amount*
            //txtprice.setText();
            setVisible(true);
        }
    }//GEN-LAST:event_btnconfirm2ActionPerformed

    private void btnconfirm1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnconfirm1ActionPerformed
        // TODO add your handling code here:
         int selectedRow = jTable2.getSelectedRow();

        if(selectedRow == -1){
            JOptionPane.showMessageDialog(this,"Please select single Row.");
        }else{
             MarketCustomerOrder.setVisible(true);
        MarketGrocery.setVisible(false);
            DefaultTableModel model = (DefaultTableModel) jTable2.getModel();

            String market = (String)model.getValueAt(selectedRow,0);
            String marketadd = (String)model.getValueAt(selectedRow,1);
           float price=(float)(model.getValueAt(selectedRow, 3));

            txtMarket.setText(market);
            txtMarket.setEditable(false);
            jTextField1.setText(marketadd);
            jTextField1.setEditable(false);
            txtprice.setText(String.valueOf(price));
            txtprice.setEditable(false);
        }
    }//GEN-LAST:event_btnconfirm1ActionPerformed

    private void btnbackActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnbackActionPerformed
        // TODO add your handling code here:
         MarketCustomerOrder.setVisible(false);
        MarketGrocery.setVisible(true);
    }//GEN-LAST:event_btnbackActionPerformed

    private void searchtxt1KeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_searchtxt1KeyReleased
        // TODO add your handling code here:
         String name=searchtxt1.getText();
        ResultSet rs=Select.getData("select * from market where Name like '%"+name+"%' and Category='Grocery'");
        DefaultTableModel model=(DefaultTableModel)jTable2.getModel();
        model.setRowCount(0);
        try {
            while(rs.next())
            {
                model.addRow(new Object[]{rs.getString(1),rs.getString(2),rs.getInt(5),rs.getFloat(6)});

            }
            rs.close();

        } catch (Exception e)
        {
            JOptionPane.showConfirmDialog(null, e);

        }
    }//GEN-LAST:event_searchtxt1KeyReleased

    private void searchtxt1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_searchtxt1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_searchtxt1ActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JComboBox<String> AmountComboBox;
    private javax.swing.JPanel MarketCustomerOrder;
    private javax.swing.JPanel MarketGrocery;
    private javax.swing.JButton btnback;
    private javax.swing.JButton btnconfirm1;
    private javax.swing.JButton btnconfirm2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JTable jTable2;
    private javax.swing.JTextField jTextField1;
    private javax.swing.JTextField jTextField2;
    private javax.swing.JTextField searchtxt1;
    public javax.swing.JTextField txtMarket;
    private javax.swing.JTextField txtaddress;
    private javax.swing.JTextField txtprice;
    private javax.swing.JTextField txtuser;
    private javax.swing.JComboBox<String> typeComboBox;
    // End of variables declaration//GEN-END:variables
}
